<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title></title>

    </head>
    <body>
        <header>
            Quiz Application
        </header>
        <section id="questions">
        </section>
        <section id="score"></section>
    </body>
    <script>
        function init() {
            var questions = '[{"question": "What is something?","options": ["answer1", "answer2"],"answer": ["answer2"]},{"question": "What is something2?","options": ["answer1", "answer2"],"answer": ["answer1", "answer2"]},{"question": "What is something3?","options": ["answer1", "answer2", "answer3"],"answer": ["answer2", "answer3"]}]';

            var dataModel = JSON.parse(questions);

            for(var i = 0; i < dataModel.length; i++) {
                var article = document.createElement('article');

                article.innerHTML = '<p>' + dataModel[i].question + '</p>';
                //i = current iteration index
                for(j = 0; j < dataModel[i].options.length; j++) {
                    var checkbox = document.createElement('input');

                    checkbox.setAttribute('type', 'checkbox');
                    checkbox.setAttribute('id', 'options' + i + '' + j);
                    checkbox.setAttribute('value', i + ':' + dataModel[i].options[j]);
                    checkbox.setAttribute('name', 'option' + i);

                    var label = document.createElement('label');

                    label.setAttribute('for', 'options' + i + '' + j);
                    label.innerHTML = dataModel[i].options[j];

                    var breakTag = document.createElement('br');

                    article.append(checkbox);
                    article.append(label);
                    article.append(breakTag);
                }

                document.getElementById('questions').append(article);
            }; 

            var button = document.createElement('button');

            button.innerHTML = 'Submit';

            button.onclick = function () {
                var questions = document.querySelectorAll('#questions article');
                // var checkboxElements = question.childNodes('[id^=options]');
                var score = 0;
                var correctAnswer = [];
                var checkboxesChecked = 0;
                    
                for (var i = 0; i < questions.length; i++) {
                    for (var j = 0; j < questions[i].childNodes.length; j++) {
                        if (questions[i].childNodes[j].nodeName === "INPUT" && questions[i].childNodes[j].checked) {
                            var option = questions[i].childNodes[j].value.split(':');
                            var correctAnswersLength = dataModel[option[0]].answer.length;

                            checkboxesChecked++;
                            
                            dataModel[option[0]].answer.forEach(function(data) {
                                if (data === option[1]) {
                                        correctAnswer.push(data);
                                }
                            });

                            if (correctAnswer.length === correctAnswersLength && checkboxesChecked === correctAnswersLength) {
                                score++;
                                correctAnswer = [];
                                checkboxesChecked = 0;
                            } 
                        }
                    }
                }

                showResults(score);
            }

            var breakTag = document.createElement('br');

            document.getElementById('questions').append(breakTag);
            document.getElementById('questions').append(button);
        }

        function showResults(score) {
                var scoreSection = document.getElementById('score');
                var article = document.createElement('article');

                removeNodes(scoreSection);
                article.innerHTML = "<p> Your score is <b>" + score + "</b></p";
                scoreSection.append(article);
        }

        function removeNodes(node) {
            while (node.hasChildNodes())
                node.removeChild(node.lastChild);
        }

        window.onload = init;
    </script>
</html>